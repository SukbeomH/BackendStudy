# BE Day14 ERD 관계형 DB

---

  **목차**

  

---

# 엑셀로 이해하는 데이터 정규화

![Untitled](BE%20Day14%20ERD%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%A8%E1%84%92%E1%85%A7%E1%86%BC%20DB%20e3cdd514b9f24070a1218b64f8f8b847/Untitled.png)

백엔드 개발자는 데이터를 다루는 일이 매우 중요합니다 

쇼핑몰을 만들어야 한다고 생각해봅시다. 여기에 들어갈 데이터는 양도 많고, 종류도 많습니다. 

그렇기 때문에 처음부터 설계를 잘해서 데이터를 정리해야합니다. 

`데이터 정규화`는 쉽게 말해, **중복 데이터**를 **분리**하는 것입니다.

# 정규형 Normal Form

![Untitled](BE%20Day14%20ERD%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%A8%E1%84%92%E1%85%A7%E1%86%BC%20DB%20e3cdd514b9f24070a1218b64f8f8b847/Untitled%201.png)

정규화가 된 결과를 정규형이라고 합니다. 

정규형의 종류에는 여러가지가 있지만, 실무에서는 일부(노란색 상자)만 사용하게 됩니다. 

따라서 우리는 모든 정규형을 살펴보지 않고 실무에서 주로 사용되는 제 3 정규형까지 만들어보겠습니다.

<aside>
💡 정규화는 단계적으로 진행되야한다는 점에 유의해주세요!

</aside>

---

# 비정규화

처음에는 모든 데이터가 하나의 테이블에 다 담겨있습니다. 정규화되지 않은 상태입니다.

`[ 주문 ]` 테이블 

| 주문번호 | 날짜 | 이름 | 나이 | 주문 상품 |
| --- | --- | --- | --- | --- |
| P001 | 10/23 | 철수 | 13 | A001 레고 1개, A002 미니카 2개 |
| P002 | 08/13 | 영희 | 15 | A003 인형 1개, A001 레고 2개 |
| P003 | 09/07 | 훈이 | 12 | A003 인형 2개, A002 미니카 1개 |

위와 같은 상태에서는 데이터를 수정하고 삭제할 때 문제가 생길 수 있습니다. 

예를 들어 P001 주문에서 주문 상품을 레고 2개로 변경하려면 주문 상품의 데이터 값에서 ‘레고'를 찾아서 그 뒤의 숫자 부분을 찾아서 1을 2로 바뀐다? 너무 이상합니다.

나이를 바꾼다고 한다면 age = 20 이런식으로 한번에 바꿀 수 있습니다. 

# 제 1 정규화

위의 테이블 처럼 한 줄에 여러 데이터가 있는 것을 **다가 속성**(Multivalued Attributed)이라고 합니다. 

첫번째로 할 일은, 엑셀 하나의 칸에는 `하나의 값`만 들어가도록 만들어줍니다. 이것이 `제 1 정규화`입니다. 

| 주문번호 | 날짜 | 이름 | 나이 | 주문 상품 |
| --- | --- | --- | --- | --- |
| P001 | 10/23 | 철수 | 13 | A001 레고 1개, A002 미니카 2개 |
| P002 | 08/13 | 영희 | 15 | A003 인형 1개, A001 레고 2개 |
| P003 | 09/07 | 훈이 | 12 | A003 인형 2개, A002 미니카 1개 |

**주문 상품** 컬럼의 값을 한개씩 갖도록 나누면 아래와 같습니다. 

| 주문번호 | 날짜 | 이름 | 나이 | 주문 상품 |
| --- | --- | --- | --- | --- |
| P001 | 10/23 | 철수 | 13 | A001 레고 1개 |
| P001 | 10/23 | 철수 | 13 | A002 미니카 2개 |
| P002 | 08/13 | 영희 | 15 | A003 인형 1개 |
| P002 | 08/13 | 영희 | 15 | A001 레고 2개 |
| P003 | 09/07 | 훈이 | 12 | A003 인형 2개 |
| P003 | 09/07 | 훈이 | 12 | A002 미니카 1개 |

그런데 이번에는 주문 상품 컬럼에 속성이 여러개(상품 번호, 상품명, 상품 수량) 들어있습니다. 이를 `복합 속성`이라고 합니다. 

하나의 칸에는 하나의 값만 들어가도록 만드는 것이 제 1 정규화라고 말씀드렸습니다. 따라서 주문 상품 컬럼을 또 분리해주겠습니다. 

| 주문번호 | 날짜 | 이름 | 나이 | 상품번호 | 상품명 | 상품수량 |
| --- | --- | --- | --- | --- | --- | --- |
| P001 | 10/23 | 철수 | 13 | A001   | 레고 | 1개 |
| P001 | 10/23 | 철수 | 13 | A002   | 미니카 | 2개 |
| P002 | 08/13 | 영희 | 15 | A003  | 인형  | 1개 |
| P002 | 08/13 | 영희 | 15 | A001  | 레고  | 2개 |
| P003 | 09/07 | 훈이 | 12 | A003   | 인형 | 2개 |
| P003 | 09/07 | 훈이 | 12 | A002  | 미니카  | 1개 |

그런데 주문번호부터 나이까지 같은 데이터가 2줄씩 들어가있습니다. 

분리하다보니, 중복 데이터가 발생한 것입니다. 

이런 상황에서는 철수의 이름을 바꾸려면 2줄 바꿔줘야합니다. 

아래와 같이 테이블을 2개로 분리함으로써 이를 개선할 수 있습니다. 

`[ 주문 ]` 테이블

| 주문번호 | 날짜 | 이름 | 나이 |
| --- | --- | --- | --- |
| P001 | 10/23 | 철수 | 13 |
| P002 | 08/13 | 영희 | 15 |
| P003 | 09/07 | 훈이 | 12 |

`[ 주문_상품 ]` 테이블

| 주문번호 | 상품번호 | 상품명 | 상품수량 |
| --- | --- | --- | --- |
| P001 | A001   | 레고 | 1개 |
| P001 | A002   | 미니카 | 2개 |
| P002 | A003  | 인형 | 1개 |
| P002 | A001  | 레고 | 2개 |
| P003 | A003   | 인형 | 2개 |
| P003 | A002  | 미니카 | 1개 |

---

# 제 2 정규화

제 2 정규화에 대해 알아보기 전에 먼저 PK(기본키)에 대해서 설명하겠습니다.

![Untitled](BE%20Day14%20ERD%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%A8%E1%84%92%E1%85%A7%E1%86%BC%20DB%20e3cdd514b9f24070a1218b64f8f8b847/Untitled%202.png)

PK(**Primary Key**)는 한줄의 데이터를 구분할 수 있는 유일한 키를 말합니다. 

주문 테이블을 보면, 주문번호를 알면 날짜, 이름, 나이를 구분할 수 있습니다. 날짜를 안다고 주문 번호를 알거나 이름을 알 수는 없습니다.

같은 날짜에 여러번 주문할 수도 있기 때문이죠. 

`주문_상품` 테이블은 주문번호나 상품번호 한가지만 알아서는 어떤 상품을 주문했는지 알 수 없습니다. 

**주문번호**와 **상품번호** 둘 다 알아야 합니다. 이를 **복합키**라고 합니다. 

`주문_상품` 테이블의 경우 처럼 **복합키**로 구성되어 있을 때, 나머지 칼럼은 이 두가지 모두에 종속되어야합니다. 

즉, 상품 수량을 알기 위해서는 주문 번호와 상품 번호를 모두 알아야합니다. 하지만, 상품명은 상품번호만 알면 알 수 있습니다. 

따라서 상품명은 복합키 중 일부에만 종속적입니다. 이런 컬럼을 분리시키는 것이 제 2 정규화입니다. 

따라서`[ 주문_상품 ]` 테이블에서 상품번호와 상품명을 아래와 같이 분리하겠습니다. 

`[ 주문 ]` 테이블

| --- | --- | --- | --- |

`[ 주문_상품 ]` 테이블

| --- | --- | --- |

`[ 상품 ]` 테이블

| 상품번호 | 상품명 |
| --- | --- |
| A001 | 레고 |
| A002 | 미니카 |
| A003 | 인형 |

---

# 제 3 정규화

 A → B → C의 관계를 가지고 있을때, A와 B, B와 C를 묶어 다른 테이블로 분리하는 것이 제 3 정규화입니다. 

주문 테이블을 보면 주문번호와 나이는 상관이 없어 보입니다. 주문 번호를 알면 누구인지 알 수 있고, 누구인지 알면 그 사람의 나이를 알 수 있습니다. 

`[ 주문 ]` 테이블

| --- | --- | --- | --- |

따라서 주문 테이블에서 고객 정보를 고객 테이블로 분리합니다. 

`[ 주문 ]` 테이블

| 주문번호 | 날짜 | 고객번호 |
| --- | --- | --- |
| P001 | 10/23 | U001 |
| P002 | 08/13 | U002 |
| P003 | 09/07 | U003 |

`[ 고객 ]` 테이블

| 고객번호 | 이름 | 나이 |
| --- | --- | --- |
| U001 | 철수 | 13 |
| U002 | 영희 | 15 |
| U003 | 훈이 | 12 |

---

### 정리된 표

제 3 정규화까지 거쳐서 정리된 표는 아래와 같습니다. 

`[ 주문 ]` 테이블

| --- | --- | --- |

`[ 고객 ]` 테이블

| --- | --- | --- |

`[ 주문_상품 ]` 테이블

| --- | --- | --- |

`[ 상품 ]` 테이블

| 상품번호 | 상품명 |
| --- | --- |
| A001 | 레고 |
| A002 | 미니카 |
| A003 | 인형 |

---

# 상품 ERD

우리가 만드는 쇼핑몰에 필요한 데이터베이스를 설계해보겠습니다. 

상품 정보는 엑셀에 저장하겠습니다. 상품 정보에는 아래의 내용이 들어갑니다.

| 다음을 표에 정리하세요 |
| --- |
| 상품명 |
| 상품내용 |
| 상품가격 |
| 상품거래주소 |
| 상품거래상세주소 |
| 상품거래위도 |
| 상품거래경도 |
| 상품거래예정시각 |
| 상품판매여부 |
| 카테고리-도서 |
| 카테고리-의류 |
| 카테고리-가전 |
| 카테고리-기타 |
| 상품태그 |
| 상품판매자이름 |
| 상품판매자이메일 |

# 비정규화

처음에는 모든 데이터가 하나의 테이블에 다 담겨있습니다.

| 상품ID | 상품명 | 상품 내용 | 상품 가격 | 상품 판매 여부 | 카테고리 | 상품 태그 | 상품 판매자 
이름 | 상품 판매자 
이메일 | 상품 거래주소 | 상품 거래상세주소 | 상품 거래위도 | 상품 거래
경도 | 상품거래
예정시각 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| P001 | 마우스 | 좋은 마우스 | 1000 | FALSE | 가전 | 전자제품, 영등포마우스 | 철수 | chulsoo@naver.com | 영등포 | 영등포역 | 10.24 | 30.1 | 10시 |
| P002 | 키보드 | 잘쳐지는 키보드 | 1500 | FALSE | 가전 | 굿키보드, 전자제품 | 영희 | hee@gmail.com | 잠실 | 잠실역 | 10.44 | 30.21 | 5시 |
| P003 | 데이터베이스 | 데이터베이스책 | 2000 | FALSE | 도서 | 책 | 훈이 | hun@naver.com | 신도림 | 신도림역 | 10.33 | 30.66 | 7시 |
| P004 | 운영체제 | 핵심운영체제 | 3000 | FALSE | 도서 | 책사랑 | 맹구 | mang@naver.com | 구로 | 구로역 | 10.37 | 30.99 | 3시 |

---

처음의 표에서 `상품 태그` 열을 살펴보면 한 칸에 여러 값(`’전자제품, 영등포마우스’`, `‘굿키보드,전자제품’`)이 들어가 있습니다.

| 상품ID | 상품명 | 상품내용 | 상품가격 | 상품판매여부 | 카테고리 | 상품태그 | 상품판매자
이름 | 상품판매자
이메일 | 상품거래주소 | 상품거래상세주소 | 상품거래위도 | 상품거래
경도 | 상품거래
예정시각 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| P001 | 마우스 | 좋은 마우스 | 1000 | FALSE | 가전 | 전자제품, 영등포마우스 | 철수 | chulsoo@naver.com | 영등포 | 영등포역 | 10.24 | 30.1 | 10시 |
| P002 | 키보드 | 잘쳐지는 키보드 | 1500 | FALSE | 가전 | 굿키보드, 전자제품 | 영희 | hee@gmail.com | 잠실 | 잠실역 | 10.44 | 30.21 | 5시 |
| P003 | 데이터베이스 | 데이터베이스책 | 2000 | FALSE | 도서 | 책 | 훈이 | hun@naver.com | 신도림 | 신도림역 | 10.33 | 30.66 | 7시 |
| P004 | 운영체제 | 핵심운영체제 | 3000 | FALSE | 도서 | 책사랑 | 맹구 | mang@naver.com | 구로 | 구로역 | 10.37 | 30.99 | 3시 |

따라서 이 부분을 분리해 아래와 같이 `하나의 값`만 가지도록 해줍니다. 

| 상품ID | 상품명 | 상품내용 | 상품가격 | 상품판매여부 | 카테고리 | 상품태그 | 상품판매자
이름 | 상품판매자
이메일 | 상품거래주소 | 상품거래상세주소 | 상품거래위도 | 상품거래
경도 | 상품거래
예정시각 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| P001 | 마우스 | 좋은 마우스 | 1000 | FALSE | 가전 | 전자제품 | 철수 | chulsoo@naver.com | 영등포 | 영등포역 | 10.24 | 30.1 | 10시 |
| P001 | 마우스 | 좋은 마우스 | 1000 | FALSE | 가전 | 영등포마우스 | 철수 | chulsoo@naver.com | 영등포 | 영등포역 | 10.24 | 30.1 | 10시 |
| P002 | 키보드 | 잘쳐지는 키보드 | 1500 | FALSE | 가전 | 굿키보드 | 영희 | hee@gmail.com | 잠실 | 잠실역 | 10.44 | 30.21 | 5시 |
| P002 | 키보드 | 잘쳐지는 키보드 | 1500 | FALSE | 가전 | 전자제품 | 영희 | hee@gmail.com | 잠실 | 잠실역 | 10.44 | 30.21 | 5시 |
| P003 | 데이터베이스 | 데이터베이스책 | 2000 | FALSE | 도서 | 책 | 훈이 | hun@naver.com | 신도림 | 신도림역 | 10.33 | 30.66 | 7시 |
| P004 | 운영체제 | 핵심운영체제 | 3000 | FALSE | 도서 | 책사랑 | 맹구 | mang@naver.com | 구로 | 구로역 | 10.37 | 30.99 | 3시 |

---

이번에는 이 테이블에서 중복된 데이터가 최대한 없도록 만들어 보겠습니다. 

아래의 상품 테이블을 보면, 보라색과 초록색 부분에서 상품ID가 중복됩니다. 

상품ID인 P001과 P002가 두번씩 나타나고 있습니다! 

그래서, 상품ID를 안다고 상품태그를 바로 알 수 없습니다. 

여기서 `상품 태그` 부분을 분리한다면 나머지는 데이터가 같기 때문에 하나의 열로 줄일 수 있을것 같습니다. 

`**[상품] 테이블**`

| 상품ID | 상품명 | 상품내용 | 상품가격 | 상품판매여부 | 카테고리 | 상품태그 | 상품판매자
이름 | 상품판매자
이메일 | 상품거래주소 | 상품거래상세주소 | 상품거래위도 | 상품거래
경도 | 상품거래
예정시각 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| P001 | 마우스 | 좋은 마우스 | 1000 | FALSE | 가전 | 전자제품 | 철수 | chulsoo@naver.com | 영등포 | 영등포역 | 10.24 | 30.1 | 10시 |
| P001 | 마우스 | 좋은 마우스 | 1000 | FALSE | 가전 | 영등포마우스 | 철수 | chulsoo@naver.com | 영등포 | 영등포역 | 10.24 | 30.1 | 10시 |
| P002 | 키보드 | 잘쳐지는 키보드 | 1500 | FALSE | 가전 | 굿키보드 | 영희 | hee@gmail.com | 잠실 | 잠실역 | 10.44 | 30.21 | 5시 |
| P002 | 키보드 | 잘쳐지는 키보드 | 1500 | FALSE | 가전 | 전자제품 | 영희 | hee@gmail.com | 잠실 | 잠실역 | 10.44 | 30.21 | 5시 |
| P003 | 데이터베이스 | 데이터베이스책 | 2000 | FALSE | 도서 | 책 | 훈이 | hun@naver.com | 신도림 | 신도림역 | 10.33 | 30.66 | 7시 |
| P004 | 운영체제 | 핵심운영체제 | 3000 | FALSE | 도서 | 책사랑 | 맹구 | mang@naver.com | 구로 | 구로역 | 10.37 | 30.99 | 3시 |

## 상품 태그 테이블 분리

아래와 같이 `상품 테이블`에서 태그를 분리해 따로 표로 만들었습니다. 

그래서 `상품 테이블`에서 상품ID의 중복이 사라졌습니다. 

`**[상품_상품태그] 테이블**`

| 상품ID | 상품 태그 |
| --- | --- |
| P001 | 전자제품 |
| P001 | 영등포마우스 |
| P002 | 굿키보드 |
| P002 | 전자제품 |
| P003 | 책 |
| P004 | 책사랑 |

`**[상품] 테이블**`

| 상품ID | 상품명 | 상품내용 | 상품가격 | 상품판매여부 | 카테고리 | 상품판매자이름 | 상품판매자이메일 | 상품거래주소 | 상품거래상세주소 | 상품거래위도 | 상품거래경도 | 상품거래예정시각 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| P001 | 마우스 | 좋은 마우스 | 1000 | FALSE | 가전 | 철수 | chulsoo@naver.com | 영등포 | 영등포역 | 10.24 | 30.1 | 10시 |
| P002 | 키보드 | 잘쳐지는 키보드 | 1500 | FALSE | 가전 | 영희 | hee@gmail.com | 잠실 | 잠실역 | 10.44 | 30.21 | 5시 |
| P003 | 데이터베이스 | 데이터베이스책 | 2000 | FALSE | 도서 | 훈이 | hun@naver.com | 신도림 | 신도림역 | 10.33 | 30.66 | 7시 |
| P004 | 운영체제 | 핵심운영체제 | 3000 | FALSE | 도서 | 맹구 | mang@naver.com | 구로 | 구로역 | 10.37 | 30.99 | 3시 |

---

## 상품과 상품 태그를 연결하는 중간 테이블

그런데 여기도 보면 전자제품 이라는 값이 중복됩니다. 

`**[상품_상품태그] 테이블**`

| 상품ID | 상품 태그 |
| --- | --- |
| P001 | 전자제품 |
| P001 | 영등포마우스 |
| P002 | 굿키보드 |
| P002 | 전자제품 |
| P003 | 책 |
| P004 | 책사랑 |

상품 태그를 위한 표만 따로 만들고, 여기서 만든 ID를 `**[상품_상품태그] 테이블**` 에 연결해줍니다.

이렇게 했을 때, **`[상품 태그] 테이블`** 을 보면 태그 값(**’전자제품’**)의 중복은 사라졌습니다. 

**`[상품 태그] 테이블`**

| 상품 태그ID | 상품 태그 |
| --- | --- |
| T001 | 전자제품 |
| T002 | 영등포마우스 |
| T003 | 굿키보드 |
| T004 | 책 |
| T005 | 책사랑 |